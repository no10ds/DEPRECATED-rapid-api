<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>rAPId - Download</title>
    <link href="/static/main.css" rel="stylesheet"/>
</head>
<body>
<div class="content">
    {% with previous_page = "/download" %} {% include 'component/header.html'
    %} {% endwith %}

    <form class="form">
        <div class="form_body form_body--headed">
            <div class="form-select">
                <h1 class="content_header">Download</h1>
            </div>
            <h3>Dataset Overview</h3>
            <table class="info-table">
                <tr>
                    <td class="bold">Domain</td>
                    <td class="highlight bold">{{dataset_info.domain}}</td>
                </tr>
                <tr>
                    <td class="bold">Dataset</td>
                    <td class="highlight bold">{{dataset_info.dataset}}</td>
                </tr>
                <tr>
                    <td class="bold">Version</td>
                    <td class="highlight bold">{{dataset_info.version}}</td>
                </tr>
                <tr>
                    <td class="bold">Last updated</td>
                    <td>{{dataset_info.last_updated}}</td>
                </tr>
                <tr>
                    <td class="bold">Number of Rows</td>
                    <td>{{dataset_info.number_of_rows}}</td>
                </tr>
                <tr>
                    <td class="bold">Number of Columns</td>
                    <td>{{dataset_info.number_of_columns}}</td>
                </tr>
            </table>
            <h3>Columns</h3>
            <table class="info-table">
                <tr>
                    <th>Name</th>
                    <th>Data Type</th>
                    <th>Allows Null</th>
                    <th>Max</th>
                    <th>Min</th>
                </tr>
                {% for column in dataset_info.columns %}
                <tr>
                    <td>{{column.name}}</td>
                    <td>{{column.data_type}}</td>
                    <td>{{column.allow_null}}</td>
                    <td>{{column.min}}</td>
                    <td>{{column.max}}</td>
                </tr>
                {% endfor %}
            </table>
            <div class="form-select">
                <label class="form-select_label" for="select_format">Data format</label>
                <select class="form-select_dropdown" id="select_format">
                    <option value="csv">csv</option>
                    <option value="json">json</option>
                </select>
            </div>
            <fieldset>
                <legend class="form-input_legend">Query (optional)</legend>
                <a class="link" href="https://github.com/no10ds/rapid-api/blob/main/docs/guides/usage/usage.md#query-structure" target="_blank">query writing guide</a>
                <div class="form-input form-input--row">
                    <label class="form-input_label" for="selectColumns">select columns</label>
                    <input class="form-input_text form-input_text--row" name="selectColumns" id="selectColumns" type="text" placeholder="column1, avg(column2)" maxlength="200">
                </div>
                <div class="form-input form-input--row">
                    <label class="form-input_label" for="filter">filter</label>
                    <input class="form-input_text form-input_text--row" name="filter" id="filter" type="text" placeholder="column >= 10" maxlength="200">
                </div>
                <div class="form-input form-input--row">
                    <label class="form-input_label" for="groupByColumns">group by columns</label>
                    <input class="form-input_text form-input_text--row" name="groupByColumns" id="groupByColumns" type="text" placeholder="column1, column3" maxlength="200">
                </div>
                <div class="form-input form-input--row">
                    <label class="form-input_label" for="aggregationConditions">aggregation conditions</label>
                    <input class="form-input_text form-input_text--row" name="aggregationConditions" id="aggregationConditions" type="text" placeholder="avg(column2) <= 15" maxlength="200">
                </div>
                <div class="form-input form-input--row">
                    <label class="form-input_label" for="rowLimit">row limit</label>
                    <input class="form-input_text form-input_text--row" name="rowLimit" id="rowLimit" type="number" placeholder="30" onkeyup="enforceMinMax(this, '{{dataset_info.number_of_rows}}')" >
                </div>
            </fieldset>
        </div>
        <h4 hidden class="response-msg--error" id="error-message"></h4>
        <div class="form_submit">
            <button class="btn" type="button" id='download-dataset'
                    onclick="downloadDataset('{{dataset_info.domain}}','{{dataset_info.dataset}}')">Download
            </button>
            <label class="response-msg" id="response-title"></label>
            <div class="loading-spinner"></div>
            <label class="response-msg" id="response"></label>
        </div>
    </form>
</div>
{% block javascript %}
<script type="text/javascript">
        {% include "./js/common.js" %}
        {% include "./js/dataset_download.js" %}
</script>
{% endblock %}
</body>
</html>
